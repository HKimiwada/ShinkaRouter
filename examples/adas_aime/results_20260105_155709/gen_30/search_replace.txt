<NAME>
dynamic_reflection_and_temperature
</NAME>

<DESCRIPTION>
To enhance the agent's reasoning capability and adapt to different problem complexities, we will implement a dynamic reflection mechanism combined with a temperature adjustment strategy. This will allow the agent to review its answers and adjust its approach based on the complexity of the problem. The reflection will prompt the agent to evaluate its reasoning after generating an answer, while the dynamic temperature will help balance creativity and accuracy based on the problem's nature. This should lead to improved performance on AIME problems.
</DESCRIPTION>

<DIFF>
<<<<<<< SEARCH
        system_prompt, task_prompt = self.get_prompt_for_task(problem)
=======
        system_prompt, task_prompt = self.get_prompt_for_task(problem)
        # Determine complexity of the problem based on keywords
        complexity_keywords = ["complex", "difficult", "challenging"]
        if any(keyword in problem.lower() for keyword in complexity_keywords):
            self.temperature = 0.7  # Higher temperature for complex problems
        else:
            self.temperature = 0.0  # Lower temperature for simpler problems
>>>>>>> REPLACE
        response, cost = self.query_llm(
            prompt=task_prompt,
            system=system_prompt,
            temperature=self.temperature,
        )
        # Multi-step reflection for verification
        reflection_prompt = (
            f"Please review your calculations and reasoning for the problem:\n\n"
            f"{problem}\n\n"
            f"Your answer is: {response}\n\n"
            f"Are there any mistakes or areas for improvement? Please explain."
        )
        reflection_response, _ = self.query_llm(
            prompt=reflection_prompt,
            system=system_prompt,
            temperature=self.temperature,
        )
        # If reflection suggests an error, return a failure message
        if "mistake" in reflection_response.lower():
            return "Reflection indicates an error in reasoning.", cost
        return response, cost

    def get_prompt_for_task(self, problem: str) -> tuple[str, str]:
        system_prompt = "You are a skilled mathematician."
        task_prompt = f"{self.output_format_instructions}:\n\nPlease solve the following problem step-by-step, showing all your reasoning. After each step, summarize your findings and check if they align with the problem requirements:\n\n{problem}\n\n"
        return system_prompt, task_prompt
>>>>>>> REPLACE
        return response, cost
</DIFF>