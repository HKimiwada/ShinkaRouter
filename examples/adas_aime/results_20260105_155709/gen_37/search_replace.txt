<NAME>
dynamic_reflection_mechanism
</NAME>

<DESCRIPTION>
Introduce a dynamic reflection mechanism that allows the model to iteratively verify its calculations and reasoning. After generating an initial response, the model could be prompted to review its work and make adjustments as necessary. This iterative approach can help catch errors that may have been overlooked in a single pass, thereby improving accuracy.
</DESCRIPTION>

<DIFF>
<<<<<<< SEARCH
        system_prompt, task_prompt = self.get_prompt_for_task(problem)
=======
        steps = self.break_down_problem(problem)
        responses = []

        for step in steps:
            system_prompt, task_prompt = self.get_prompt_for_task(step)
            response, cost = self.query_llm(
                prompt=task_prompt,
                system=system_prompt,
                temperature=self.temperature,
            )
            responses.append(response)

        # Dynamic reflection mechanism
        reflection_prompt = f"Reflect on the following responses: {responses}. What corrections or improvements can be made?"
        reflection_response, reflection_cost = self.query_llm(
            prompt=reflection_prompt,
            system=system_prompt,
            temperature=self.temperature,
        )
        responses.append(reflection_response)

        final_answer = self.refine_answer(responses)
>>>>>>> REPLACE
        return response, cost
</DIFF>

<NAME>
break_down_problem
</NAME>

<DESCRIPTION>
Add a method to break down the problem into manageable steps. This will help the agent to focus on smaller components of the problem, making it easier to generate accurate responses.
</DESCRIPTION>

<DIFF>
<<<<<<< SEARCH
    def get_prompt_for_task(self, problem: str) -> tuple[str, str]:
=======
    def break_down_problem(self, problem: str) -> List[str]:
        """Breaks down the problem into manageable steps."""
        return [
            f"Step {i + 1}: {problem}" for i in range(5)  # Example: 5 steps
        ]

    def get_prompt_for_task(self, step: str) -> tuple[str, str]:
>>>>>>> REPLACE
        system_prompt = "You are a skilled mathematician."
        task_prompt = f"{self.output_format_instructions}:\n\n{problem}\n\n"
        return system_prompt, task_prompt
</DIFF>