<NAME>
enhanced_routing_logic
</NAME>

<DESCRIPTION>
The current routing logic primarily uses `deep_think` for medium and hard problems, which can lead to excessive LLM calls without sufficient verification. To improve performance, I propose a multi-stage approach for medium and hard problems that incorporates `self_critique` after `deep_think`. This will allow the agent to refine its answer before verification, potentially increasing accuracy while managing the number of calls. Additionally, for medium problems, I will introduce a fallback to `quick_solve` if `deep_think` does not yield a valid answer, which can help reduce costs.
</DESCRIPTION>

<DIFF>
<<<<<<< SEARCH
        elif difficulty == 'medium':
            response, deep_cost = self.deep_think(problem)
            boxed_answer = self.extract_boxed_answer(response)
            if boxed_answer:
                response, verify_cost = self.verify(problem, boxed_answer)
                cost = deep_cost + verify_cost
            else:
                cost = deep_cost
        else:  # difficult
            response, cost = self.deep_think(problem)
=======
        elif difficulty == 'medium':
            response, deep_cost = self.deep_think(problem)
            boxed_answer = self.extract_boxed_answer(response)
            if boxed_answer:
                # Introduce self_critique for refinement
                critique_response, critique_cost = self.self_critique(problem, response)
                boxed_answer = self.extract_boxed_answer(critique_response)
                if boxed_answer:
                    response, verify_cost = self.verify(problem, boxed_answer)
                    cost = deep_cost + critique_cost + verify_cost
                else:
                    cost = deep_cost + critique_cost
            else:
                # Fallback to quick_solve if deep_think fails
                response, quick_cost = self.quick_solve(problem)
                boxed_answer = self.extract_boxed_answer(response)
                if boxed_answer:
                    verify_response, verify_cost = self.verify(problem, boxed_answer)
                    cost = quick_cost + verify_cost
                else:
                    cost = quick_cost
        else:  # hard
            response, deep_cost = self.deep_think(problem)
            boxed_answer = self.extract_boxed_answer(response)
            if boxed_answer:
                critique_response, critique_cost = self.self_critique(problem, response)
                boxed_answer = self.extract_boxed_answer(critique_response)
                if boxed_answer:
                    response, verify_cost = self.verify(problem, boxed_answer)
                    cost = deep_cost + critique_cost + verify_cost
                else:
                    cost = deep_cost + critique_cost
>>>>>>> REPLACE
</DIFF>